# If you're using fastfetch with Powerlevel10k's instant prompt feature, it's a known source of incompatibility. fastfetch command in your .zshrc file is placed before the initialization of p10k-instant-prompt
fastfetch

# Check if Powerlevel10k is installed
if [ ! -f "${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k/powerlevel10k.zsh-theme" ]; then
  echo "Powerlevel10k not found. Installing..."
  git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k
  echo "Powerlevel10k installed."
fi

# Check if Starship is installed, if not, install it
if ! command -v starship &> /dev/null; then
  echo "Starship not found, installing..."
  sudo apt update
  sudo apt install starship -y
fi

# Check if Oh My Zsh is installed
if [ ! -d "$HOME/.oh-my-zsh" ]; then
  # Oh My Zsh is not installed, proceed with installation
  echo "Oh My Zsh not found. Installing..."
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
else
  # Oh My Zsh is installed, source it
  source $HOME/.oh-my-zsh/oh-my-zsh.sh
fi

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# If you come from bash you might have to change your $PATH.
export PATH=$HOME/bin:$HOME/.local/bin:/usr/local/bin:$PATH

# Path to your Oh My Zsh installation.
export ZSH="$HOME/.oh-my-zsh"

ZSH_THEME="powerlevel10k/powerlevel10k"

zstyle ':omz:update' mode auto      # update automatically without asking


# Uncomment the following line to change how often to auto-update (in days).
zstyle ':omz:update' frequency 13

# Uncomment the following line to enable command auto-correction.
ENABLE_CORRECTION="true"

# Add wisely, as too many plugins slow down shell startup.
plugins=(git zsh-autosuggestions zsh-syntax-highlighting you-should-use zsh-bat ansible aliases chezmoi colored-man-pages compleat fzf themes )

# Load oh my zsh  
source $ZSH/oh-my-zsh.sh

# You may need to manually set your language environment
export LANG=en_US.UTF-8

# Preferred editor for local and remote sessions
 if [[ -n $SSH_CONNECTION ]]; then
   export EDITOR='nano'
 else
   export EDITOR='nano'
 fi

source ~/powerlevel10k/powerlevel10k.zsh-theme

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# Load Aliases and Finctions, instead of adding them here directly.
if [ -e $HOME/.bash_aliases ]; then
   source $HOME/.bash_aliases
fi

if [ -e $HOME/.bash_functions ]; then
   source $HOME/.bash_functions
fi


eval "$(starship init zsh)"

export GITHUB_USERNAME="mmcferidge1969"

# Added by LM Studio CLI (lms)
export PATH="$PATH:/home/miker/.lmstudio/bin"
# End of LM Studio CLI section

# Automatically preform ls when changing directory,
cd() {
    builtin cd "$@" && ls -lA
}

# History Settings
HISTCONTROL=ignoreboth
shopt -s histappend
HISTSIZE=20000
HISTFILESIZE=10000
shopt -s checkwinsize
shopt -s cmdhist

# Alias/Functions (from .bash_aliases and .bash_functions)
if [ -e $HOME/.bash_aliases ]; then
  source $HOME/.bash_aliases
fi

if [ -e $HOME/.bash_functions ]; then
  source $HOME/.bash_functions
fi


# Git Branch Function
parse_git_branch() {
  local branch=$(git rev-parse --abbrev-ref HEAD 2>/dev/null)
  if [[ -n "$branch" ]]; then
    local dirty=$(git status --porcelain 2>/dev/null | grep -q '^[A-Z]' && echo "*" || true)
    echo "[$branch$dirty]"
  else
    echo ""
  fi
}

# GIT Global Settings
git config --global user.name "mmcfetridge1969"
git config --global user.email "mmcfetridg@aol.com"

# Package Management 
sudo apt update && sudo apt upgrade
sudo apt install zsh zsh-autosuggestions zsh-syntax-highlighting